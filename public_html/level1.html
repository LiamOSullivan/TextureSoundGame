<!DOCTYPE html>
<!--
    Created on : 24-Oct-2016, 09:04:21
    Author     : Liam O'Sullivan

Sprint Backlog:
Load images on page load from directory, rather then creating large array?
Persistent storage: https://www.w3.org/TR/2009/WD-webstorage-20091222/

'Game level' 2Up, 3UP etc...

Record IP address of visitor.

Store list of images already displayed and skip/ allow n uses.

Add sound visualisation option- makes a difference to results?

Compare against performance of waveform display?


Product Backlog:
FW: Allow user modified sounds if they disagree, include ML to adapt future sounds.
-->
<html>
    <head>
        <title>The Texture-Sound Game!</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script></script>
        <link rel="stylesheet" type="text/css" href="texturegame.css">


    </head>
    <body>
        <div align="center">
            <H1>Click on the picture you think is making the sound!</H1>
            <br>
            <img onmouseover="highlightImage(this)" onmouseout="deHighlightImage(this)"
                 width="200" height="200" id="leftPicture" alt="a texture image" 
                 style="border:4px solid black" >
            <img onmouseover="highlightImage(this)" onmouseout="deHighlightImage(this)"
                 width="200" height="200" id="rightPicture" alt="a texture image" 
                 style="border:4px solid black" >
            <br>
        </div>
        <div align=center>
            <H2 id="score"><font id="scoreColor" color="black">SCORE: 0</font></H2>
            <H3>You can replay the sound and adjust the volume below:</H3>

            <audio id="sound1" controls>
                <source  type="audio/mpeg" >
                <source  type="audio/wav" >
                Your browser does not support the audio element.
            </audio>

        </div>
        <form>
            <!-- fulfill HTML brief reqs here-->
        </form>
        <script>
            //JS code here...
            var nImages = 100;
            var imageArray = [];
            var soundArray = [];
            var volumeLevel = 0.3; //updated by volume control
            var testSound = document.getElementById("sound1"); //sound playing
            var soundID = -1;
            var testImage1 = document.getElementById("leftPicture");
            var testImage2 = document.getElementById("rightPicture");
            var ntestsPerLevel = 5;
            var nTestsCompleted = 0;
            var testScore = 0;
            var scoreDisplay = document.getElementById("score");
            //var scoreFontColor = document.getElementById("scoreColor");
            var debug = true;

            //store the details of the current test
            var test = {
                id: "-1",
                type: "l1",
                image1: "dummy.bmp", image2: "dummy.bmp",
                sound: "dummy.wav",
                answer: "-1",
                correct: "-1",
                playCount: "-1" //useful to know if sounds replayed
            }

            var tests = []; //will be saved on completion of test level

            function initImageArray() {
                //Use a better way to load the number of images I need (~2-5),
                //rather than filling a large array every time the page is loaded?
                for (var i = 0; i <= nImages; i++) {
                    var iPath = "images/rastrograms/image" + i + ".bmp";
                    imageArray.push(iPath);
                }
                console.log("imageArray has " + imageArray.length + " elements");
            }
            function initSoundArray() {
                for (var i = 0; i <= nImages; i++) {
                    //var iPath = "sounds/" + i + ".mp3"; //TODO
                    //var iPath = "sounds/1.mp3";      //placeholder  
                    var iPath = "sounds/audio-numbers/" + i + ".wav";
                    soundArray.push(iPath);
                }
                console.log("soundArray has " + soundArray.length + " elements");
            }

            function chooseImages() {
                //TODO ensure different pics chosen
                var randomNum1 = Math.floor(Math.random() * imageArray.length);
                testImage1.src = imageArray[randomNum1];
                if (debug) {
                    testImage1.title = "Texture #" + randomNum1; //gives image index as rollover
                } //for debug
                testImage1.onclick = function () {
                    imageClickEvent(randomNum1)
                };
                var randomNum2 = Math.floor(Math.random() * imageArray.length);
                while (randomNum2 == randomNum1) {
                    randomNum2 = Math.floor(Math.random() * imageArray.length); //ensure both images are never the same
                }
                testImage2.src = imageArray[randomNum2];
                if (debug) {
                    testImage2.title = "Texture #" + randomNum2;
                }
                testImage2.onclick = function () {
                    imageClickEvent(randomNum2)
                };

                console.log("load images " + randomNum1 + " and " + randomNum2);
                //pick one of the 2 random numbers to use that sound index
                var picked = Math.random() < 0.5 ? randomNum1 : randomNum2;
                console.log("picking sound " + picked);
                chooseSound(picked);

            }

            function chooseSound(n) {
                testSound.src = soundArray[n];
                soundId = n;
                testSound.volume = volumeLevel;
            }

            function playSound() {
                testSound.play();

            }
            //Various event handlers...

            function highlightImage(img) {
                img.style.border="4px solid springgreen";

            }
            function deHighlightImage(img) {
                
                img.style.border="4px solid black";
            }

            //volume change event
            testSound.onvolumechange = function () {
                volumeLevel = testSound.volume; //store the change to volume level 
                console.log("The volume has been changed to " + testSound.volume);
            };

            //image click event
            function imageClickEvent(n) {
                console.log(n.valueOf()); //echo selcted image id
                if (testScore < 4) {
                    if (n == soundId) {
                        console.log("***correct!***"); //echo selcted image id
                        testScore += 1;
                        nTestsCompleted += 1;
                        var str = "&#10004; SCORE: " + testScore + " / " + nTestsCompleted; //TODO: better way than this?
                        var strColor = str.fontcolor("green");
                        scoreDisplay.innerHTML = strColor;


                    }
                    else {
                        console.log("***incorrect!***"); //echo selcted image id
                        nTestsCompleted += 1;
                        var str = "&#10008 SCORE: " + testScore + " / " + nTestsCompleted;
                        var strColor = str.fontcolor("red");
                        scoreDisplay.innerHTML = strColor;
                    }
                    //saveData();
                    chooseImages();
                    setTimeout(playSound, 1000); //delay start of playback
                }
                else {
                    var str = "&#10004; 5 CORRECT!";
                    var strColor = str.fontcolor("orange");
                    scoreDisplay.innerHTML = strColor;
                    setTimeout(nextLevel, 2000);
                }
            }
            function nextLevel() {

            }
            //called on page load event
            function start() {

                initImageArray();
                initSoundArray();
                chooseImages(); //chooseSound() is called from here
                setTimeout(playSound, 1000); //delay playback

            }
            window.onload = start;
        </script>
    </body>

</html>
